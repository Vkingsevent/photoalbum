<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Cloudinary Album</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
    }
    #gallery {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .img-card {
      position: relative;
      display: inline-block;
    }
    .img-card img {
      width: 150px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
    .delete-btn {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>My Cloudinary Album</h1>
<input type="file" id="fileInput" accept="image/*">
<div id="gallery"></div>

<script>
  const cloudName = 'dmx3gppso';  // your cloud name
  const uploadPreset = 'Imageuploader';  // your upload preset
  const folderName = 'myalbum';  // folder where images are stored

  const fileInput = document.getElementById('fileInput');
  const gallery = document.getElementById('gallery');

  // Function to fetch and display all images
  async function loadImages() {
    gallery.innerHTML = 'Loading...';
    try {
      const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/resources/image/upload?prefix=${folderName}/&max_results=100`, {
        headers: {
          'Authorization': 'Basic ' + btoa('API_KEY:API_SECRET')  // We can't directly use authorization here in frontend (security issue)
        }
      });
      const data = await response.json();
      gallery.innerHTML = '';

      if (data.resources && data.resources.length > 0) {
        data.resources.forEach(file => {
          const imgCard = document.createElement('div');
          imgCard.className = 'img-card';
          
          const img = document.createElement('img');
          img.src = file.secure_url;
          img.alt = file.public_id;

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'delete-btn';
          deleteBtn.textContent = 'X';
          deleteBtn.onclick = () => deleteImage(file.public_id);

          imgCard.appendChild(img);
          imgCard.appendChild(deleteBtn);
          gallery.appendChild(imgCard);
        });
      } else {
        gallery.innerHTML = 'No images found.';
      }
    } catch (error) {
      gallery.innerHTML = 'Error loading images.';
      console.error(error);
    }
  }

  // Upload a new image
  fileInput.addEventListener('change', async () => {
    const file = fileInput.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', uploadPreset);
    formData.append('folder', folderName);

    try {
      const upload = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
        method: 'POST',
        body: formData
      });

      if (upload.ok) {
        alert('Image uploaded!');
        loadImages();
      } else {
        alert('Upload failed.');
      }
    } catch (error) {
      alert('Upload error.');
      console.error(error);
    }
  });

  // Delete an image
  async function deleteImage(publicId) {
    const confirmDelete = confirm('Are you sure you want to delete this image?');
    if (!confirmDelete) return;

    alert('Delete function cannot work fully on frontend due to security! Need to create a backend server to authorize deletion.');

    // To actually delete: you need a backend server to securely call Cloudinary's delete API with your API secret.
  }

  // Load images initially
  loadImages();
</script>

</body>
</html>
